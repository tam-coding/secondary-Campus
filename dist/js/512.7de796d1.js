(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[512],{1512:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return f}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"index-body"},[e("el-card",[e("el-row",{staticClass:"tac"},[e("el-col",{attrs:{span:3}},[e("el-menu",{staticClass:"el-menu-vertical-demo",staticStyle:{height:"80vh"},attrs:{"default-active":t.index,"background-color":"#504c4c","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:t.handleSelect}},[e("el-submenu",{attrs:{index:"0"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-chat-line-round"}),e("span",[t._v("信息")])]),e("el-menu-item-group",t._l(t.friendList,(function(s,i){return t.friendList?e("el-menu-item",{key:s.id,staticStyle:{padding:"0px 30px","min-width":"0"},attrs:{index:`0-${i}`}},[t._v(t._s(s.tnickname)+" "),e("el-badge",{staticClass:"mark",staticStyle:{"line-height":"0"},attrs:{hidden:0==s.noReplyNum,value:s.noReplyNum}})],1):t._e()})),1)],2),e("el-menu-item",{attrs:{index:"1"}},[e("i",{staticClass:"el-icon-s-custom"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 好友列表 ")])]),e("el-menu-item",{attrs:{index:"2"}},[e("i",{staticClass:"el-icon-plus"}),e("span",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[t._v(" 好友申请 "),t.addList.length>0?e("el-badge",{staticClass:"mark",staticStyle:{"line-height":"0px"},attrs:{value:t.addList.length}}):t._e()],1)])],1)],1),e("el-col",{directives:[{name:"show",rawName:"v-show",value:"2"==t.index,expression:"index=='2'"}],attrs:{span:10}},[e("el-card",[t._l(t.addList,(function(s,i){return t.addList.length>0?e("div",{key:s.id,staticClass:"add-list-each"},[e("div",[e("el-avatar",{attrs:{shape:"square",size:50,src:s.icon}})],1),e("span",{staticStyle:{"font-weight":"bold","font-size":"22px"}},[t._v(t._s(s.tnickname)+"·"+t._s(s.createTime)+" ")]),e("el-button",{staticStyle:{margin:"auto 2px"},attrs:{type:"primary"},on:{click:function(e){return t.acceptFriendAdd(s)}}},[t._v("同意")])],1):t._e()})),0==t.addList.length?e("div",{staticClass:"add-list-each",staticStyle:{"font-weight":"bold","font-size":"22px"}},[t._v(" 暂无好友申请 ")]):t._e()],2)],1),e("el-col",{directives:[{name:"show",rawName:"v-show",value:"1"==t.index,expression:"index=='1'"}],attrs:{span:10}},[e("el-card",[t._l(t.friendList,(function(s,i){return t.friendList.length>0?e("div",{key:s.id,staticClass:"add-list-each"},[e("div",[e("el-avatar",{attrs:{shape:"square",size:50,src:s.icon}})],1),e("span",{staticStyle:{"font-weight":"bold","font-size":"22px"}},[t._v(t._s(s.tnickname))]),e("el-button",{staticStyle:{margin:"auto 2px"},attrs:{type:"primary"},on:{click:function(e){return t.chat(s,i)}}},[t._v("沟通")])],1):t._e()})),0==t.friendList.length?e("div",{staticClass:"add-list-each",staticStyle:{"font-weight":"bold","font-size":"22px"}},[t._v(" 暂无好友 ")]):t._e()],2)],1),t.index.includes("0-")?e("el-col",{attrs:{span:15}},[e("el-card",{staticStyle:{"margin-left":"8px"}},[e("div",{staticStyle:{"font-weight":"bold","font-size":"22px","text-align":"center"}},[t._v(t._s(t.currentCommnicator?.tnickname))]),e("div",{staticStyle:{"border-top":"1px solid #ccc"}}),e("div",{ref:"chatWindow",staticClass:"chatWindow"},t._l(t.messageList,(function(s,i){return e("div",{key:i},[s.senderUid==t.currentCommnicator?.tuid?e("div",{staticClass:"bkbubble left"},[e("span",{staticClass:"bkbubble-right"},[e("div",{staticClass:"chat-text"},[t._v(t._s(s.message))])]),e("span",{staticClass:"triangle-top-right"}),e("el-avatar",{staticClass:"chat-avatar",attrs:{src:t.currentCommnicator?.icon}})],1):t._e(),s.senderUid==t.myInfo?.uid?e("div",{staticClass:"bkbubble right"},[e("el-avatar",{staticClass:"chat-avatar",attrs:{src:t.myInfo?.icon}}),e("span",{staticClass:"triangle-top-left"}),e("span",{staticClass:"bkbubble-left"},[e("div",{staticClass:"chat-text"},[t._v(t._s(s.message))])])],1):t._e()])})),0),e("div",{staticClass:"inputPart",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)}}},[e("el-input",{staticStyle:{width:"700px"},attrs:{type:"textarea",placeholder:"",rows:"3",resize:"none"},model:{value:t.inputcontent,callback:function(e){t.inputcontent=e},expression:"inputcontent"}}),e("el-button",{staticStyle:{"margin-left":"5px",height:"50%"},attrs:{type:"info",plain:""},on:{click:t.sendMessage}},[t._v("发送")])],1)])],1):t._e()],1)],1)],1)},n=[],r=s(721),a=s(3962),c=s(5743),o=s.n(c),u={name:"message",data(){return{addList:[],friendList:[],index:"0-0",inputcontent:"",myInfo:{},currentCommnicator:null,messageList:[]}},mounted(){this.getAddList(),this.getFriendList(),this.myInfo=(0,a.bG)(),this.onmessage(),this.getMessageList();const t=this.$refs.chatWindow;this.observer=new MutationObserver(this.handleMutation),this.observer.observe(t,{childList:!0}),this.$bus.$on("chatElsePage",this.handleChatElsePage)},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{async getAddList(){let t=await this.$API.reqGetAddList();200==t.code&&(this.addList=t.data,this.addList.forEach((async t=>{const e=o()(t.createTime),s=o()(),i=s.diff(e,"hour");if(i<1)t.createTime="1小时内";else if(i<24){const i=s.diff(e,"hour");t.createTime=i+"小时前"}else{const i=s.diff(e,"day");t.createTime=i+"天前"}let n=await this.$API.reqAddRequesterInfo(t.tuid);200==n.code&&this.$set(t,"icon",n.data.icon)})))},async acceptFriendAdd(t){let e=await this.$API.reqAgreeFriend(t.tuid);200==e.code&&(this.addList=[],this.$message({type:"success",message:"已成为好友"}))},async getFriendList(){let t=await this.$API.reqGetFriendList();200==t.code&&(this.friendList=t.data,this.friendList.forEach((async t=>{this.$set(t,"noReplyNum",(0,r.eu)(this.myInfo.uid,t.tuid));let e=await this.$API.reqAddRequesterInfo(t.tuid);200==e.code&&this.$set(t,"icon",e.data.icon.includes("null")?"":e.data.icon)})),this.friendList.length>0&&(this.currentCommnicator=this.friendList[0],this.getMessageList(),this.clearFirstNoReplyNum()))},handleSelect(t){this.index=t;const[e,s]=this.index.split("-"),i=this.friendList[s];this.currentCommnicator=i,0==e&&(this.getMessageList(),(0,r.My)(this.myInfo.uid,this.friendList[s].tuid),this.friendList[s].noReplyNum=0),"1"==t?this.getFriendList():"2"==t&&this.getAddList()},chat(t,e){this.handleSelect(`0-${e}`)},sendMessage(){const t=this.currentCommnicator.tuid,e=this.inputcontent;this.sendMsg={tid:t,message:e},console.log(`向${this.currentCommnicator.tuid}发送了`+e),(0,r.PJ)(this.myInfo.uid,this.currentCommnicator.tuid,{senderUid:this.myInfo.uid,message:this.inputcontent}),console.log("我在send中去 存储发送的内容了"),this.getMessageList(),this.inputcontent="",this.$bus.socket.send(JSON.stringify(this.sendMsg))},onmessage(){this.$bus.socket.onmessage=t=>{const[e,s]=t.data.split(",");if("对方当前不在线，您的消息将暂时保留"!=s){if(e!=this.currentCommnicator.tuid){const t=this.friendList.findIndex((t=>t.tuid==e));(0,r.pO)(this.myInfo.uid,this.friendList[t].tuid),this.friendList[t].noReplyNum=(0,r.eu)(this.myInfo.uid,this.friendList[t].tuid)}(0,r.PJ)(this.myInfo.uid,e,{senderUid:e,message:s}),this.getMessageList(),console.log("我是message中的onmessage 我收到信息 并去保持",t.data)}}},getMessageList(){this.messageList=(0,r.FC)(this.myInfo.uid,this.currentCommnicator?.tuid)},scrollToBottom(){const t=this.$refs.chatWindow;t.scrollTop=t.scrollHeight},handleMutation(){this.scrollToBottom()},handleChatElsePage(t){const e=this.friendList.findIndex((t=>{t.tuid}));this.handleSelect(`0-${e}`)},clearFirstNoReplyNum(){(0,r.My)(this.myInfo.uid,this.friendList[0].tuid),this.friendList[0].noReplyNum=0}}},d=u,l=s(1001),h=(0,l.Z)(d,i,n,!1,null,null,null),f=h.exports},5743:function(t){!function(e,s){t.exports=s()}(0,(function(){"use strict";var t=1e3,e=6e4,s=36e5,i="millisecond",n="second",r="minute",a="hour",c="day",o="week",u="month",d="quarter",l="year",h="date",f="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],s=t%100;return"["+t+(e[(s-20)%10]||e[s]||e[0])+"]"}},y=function(t,e,s){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(s)+t},$={s:y,z:function(t){var e=-t.utcOffset(),s=Math.abs(e),i=Math.floor(s/60),n=s%60;return(e<=0?"+":"-")+y(i,2,"0")+":"+y(n,2,"0")},m:function t(e,s){if(e.date()<s.date())return-t(s,e);var i=12*(s.year()-e.year())+(s.month()-e.month()),n=e.clone().add(i,u),r=s-n<0,a=e.clone().add(i+(r?-1:1),u);return+(-(i+(s-n)/(r?n-a:a-n))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:l,w:o,d:c,D:h,h:a,m:r,s:n,ms:i,Q:d}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},v="en",b={};b[v]=p;var M=function(t){return t instanceof S},L=function t(e,s,i){var n;if(!e)return v;if("string"==typeof e){var r=e.toLowerCase();b[r]&&(n=r),s&&(b[r]=s,n=r);var a=e.split("-");if(!n&&a.length>1)return t(a[0])}else{var c=e.name;b[c]=e,n=c}return!i&&n&&(v=n),n||!i&&v},_=function(t,e){if(M(t))return t.clone();var s="object"==typeof e?e:{};return s.date=t,s.args=arguments,new S(s)},w=$;w.l=L,w.i=M,w.w=function(t,e){return _(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var S=function(){function p(t){this.$L=L(t.locale,null,!0),this.parse(t)}var y=p.prototype;return y.parse=function(t){this.$d=function(t){var e=t.date,s=t.utc;if(null===e)return new Date(NaN);if(w.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(m);if(i){var n=i[2]-1||0,r=(i[7]||"0").substring(0,3);return s?new Date(Date.UTC(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)):new Date(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},y.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},y.$utils=function(){return w},y.isValid=function(){return!(this.$d.toString()===f)},y.isSame=function(t,e){var s=_(t);return this.startOf(e)<=s&&s<=this.endOf(e)},y.isAfter=function(t,e){return _(t)<this.startOf(e)},y.isBefore=function(t,e){return this.endOf(e)<_(t)},y.$g=function(t,e,s){return w.u(t)?this[e]:this.set(s,t)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(t,e){var s=this,i=!!w.u(e)||e,d=w.p(t),f=function(t,e){var n=w.w(s.$u?Date.UTC(s.$y,e,t):new Date(s.$y,e,t),s);return i?n:n.endOf(c)},m=function(t,e){return w.w(s.toDate()[t].apply(s.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(e)),s)},g=this.$W,p=this.$M,y=this.$D,$="set"+(this.$u?"UTC":"");switch(d){case l:return i?f(1,0):f(31,11);case u:return i?f(1,p):f(0,p+1);case o:var v=this.$locale().weekStart||0,b=(g<v?g+7:g)-v;return f(i?y-b:y+(6-b),p);case c:case h:return m($+"Hours",0);case a:return m($+"Minutes",1);case r:return m($+"Seconds",2);case n:return m($+"Milliseconds",3);default:return this.clone()}},y.endOf=function(t){return this.startOf(t,!1)},y.$set=function(t,e){var s,o=w.p(t),d="set"+(this.$u?"UTC":""),f=(s={},s[c]=d+"Date",s[h]=d+"Date",s[u]=d+"Month",s[l]=d+"FullYear",s[a]=d+"Hours",s[r]=d+"Minutes",s[n]=d+"Seconds",s[i]=d+"Milliseconds",s)[o],m=o===c?this.$D+(e-this.$W):e;if(o===u||o===l){var g=this.clone().set(h,1);g.$d[f](m),g.init(),this.$d=g.set(h,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](m);return this.init(),this},y.set=function(t,e){return this.clone().$set(t,e)},y.get=function(t){return this[w.p(t)]()},y.add=function(i,d){var h,f=this;i=Number(i);var m=w.p(d),g=function(t){var e=_(f);return w.w(e.date(e.date()+Math.round(t*i)),f)};if(m===u)return this.set(u,this.$M+i);if(m===l)return this.set(l,this.$y+i);if(m===c)return g(1);if(m===o)return g(7);var p=(h={},h[r]=e,h[a]=s,h[n]=t,h)[m]||1,y=this.$d.getTime()+i*p;return w.w(y,this)},y.subtract=function(t,e){return this.add(-1*t,e)},y.format=function(t){var e=this,s=this.$locale();if(!this.isValid())return s.invalidDate||f;var i=t||"YYYY-MM-DDTHH:mm:ssZ",n=w.z(this),r=this.$H,a=this.$m,c=this.$M,o=s.weekdays,u=s.months,d=s.meridiem,l=function(t,s,n,r){return t&&(t[s]||t(e,i))||n[s].slice(0,r)},h=function(t){return w.s(r%12||12,t,"0")},m=d||function(t,e,s){var i=t<12?"AM":"PM";return s?i.toLowerCase():i};return i.replace(g,(function(t,i){return i||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return w.s(e.$y,4,"0");case"M":return c+1;case"MM":return w.s(c+1,2,"0");case"MMM":return l(s.monthsShort,c,u,3);case"MMMM":return l(u,c);case"D":return e.$D;case"DD":return w.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(s.weekdaysMin,e.$W,o,2);case"ddd":return l(s.weekdaysShort,e.$W,o,3);case"dddd":return o[e.$W];case"H":return String(r);case"HH":return w.s(r,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return m(r,a,!0);case"A":return m(r,a,!1);case"m":return String(a);case"mm":return w.s(a,2,"0");case"s":return String(e.$s);case"ss":return w.s(e.$s,2,"0");case"SSS":return w.s(e.$ms,3,"0");case"Z":return n}return null}(t)||n.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(i,h,f){var m,g=this,p=w.p(h),y=_(i),$=(y.utcOffset()-this.utcOffset())*e,v=this-y,b=function(){return w.m(g,y)};switch(p){case l:m=b()/12;break;case u:m=b();break;case d:m=b()/3;break;case o:m=(v-$)/6048e5;break;case c:m=(v-$)/864e5;break;case a:m=v/s;break;case r:m=v/e;break;case n:m=v/t;break;default:m=v}return f?m:w.a(m)},y.daysInMonth=function(){return this.endOf(u).$D},y.$locale=function(){return b[this.$L]},y.locale=function(t,e){if(!t)return this.$L;var s=this.clone(),i=L(t,e,!0);return i&&(s.$L=i),s},y.clone=function(){return w.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},p}(),x=S.prototype;return _.prototype=x,[["$ms",i],["$s",n],["$m",r],["$H",a],["$W",c],["$M",u],["$y",l],["$D",h]].forEach((function(t){x[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),_.extend=function(t,e){return t.$i||(t(e,S,_),t.$i=!0),_},_.locale=L,_.isDayjs=M,_.unix=function(t){return _(1e3*t)},_.en=b[v],_.Ls=b,_.p={},_}))}}]);
//# sourceMappingURL=512.7de796d1.js.map